<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{{ heading }}</title>
    <meta name="description" content="Easily share and distribute files">
    <meta property="og:title" content="Khaan Films FileToLink">
    <meta property="og:description" content="File Streamer">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://cdn.jsdelivr.net/gh/fyaz05/Resources@main/FileToLink/live.png">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="color-scheme" content="dark light">
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/fyaz05/Resources@main/FileToLink/Thunder.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link href="https://vjs.zencdn.net/8.20.4/video-js.css" rel="stylesheet" />
    <link href="https://unpkg.com/videojs-hls-quality-selector@1.1.3/dist/videojs-hls-quality-selector.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fyaz05/Resources@main/FileToLink/style.css">
    <style>
      .player-container { max-width: 100%; width: 100%; display:flex; justify-content:center; align-items:center; }
      .video-js { width: 100%; max-height: 78vh; border-radius: 8px; overflow: hidden; }
    </style>
</head>
<body>
    <button class="theme-toggle button-base" aria-label="Toggle Light/Dark Mode" aria-pressed="false" title="Toggle Light/Dark Mode">
        <i class="fas fa-moon" aria-hidden="true"></i>
    </button>
    <div class="background-animation" aria-hidden="true">
        <div class="bg-gradient"></div>
    </div>
    <div class="container">
        <header class="header">
            <div class="file-info">
                <h1 id="file-name">{{ file_name }}</h1>
                <div class="file-meta" role="group" aria-label="File metadata"></div>
            </div>
        </header>
        <main id="main-content">
            <section class="player-container" aria-label="Video Player">
                <video id="player" class="video-js vjs-default-skin" controls preload="metadata" playsinline controlsList="nodownload" data-setup='{}' aria-label="Video player">
                    <p class="vjs-no-js">
                      Your browser does not support HTML5 video. Please
                      <a href="{{ src }}" download>download the video</a> instead.
                    </p>
                </video>
            </section>
            <nav class="controls-section" aria-label="File options">
                <button id="download-btn" type="button" class="action-button button-base secondary-button" title="Download the video" aria-label="Download video file">
                    <i class="fas fa-cloud-download-alt" aria-hidden="true"></i>
                    <span>Download</span>
                </button>
                <button id="copy-btn" type="button" class="action-button button-base secondary-button" title="Copy video link" aria-label="Copy video link to clipboard">
                    <i class="fas fa-copy" aria-hidden="true"></i>
                    <span>Copy Link</span>
                </button>
            </nav>
        </main>
    </div>
    <footer>
        <p><span id="Khaan Films-text">⚡ Khaan Films</span> © <span id="current-year"></span> | 
        <a href="https://www.khaanfilms.com/" target="_blank" rel="noopener noreferrer" aria-label="View source code on GitHub">
        <i class="fab fa-github" aria-hidden="true"></i> <span>GitHub</span></a></p>
    </footer>
    <div class="toast" id="toast" role="alert" aria-live="polite" aria-atomic="true" aria-hidden="true">
        <div class="toast-icon" aria-hidden="true"><i class="fas fa-info-circle"></i></div>
        <div class="toast-message">Action completed.</div>
    </div>
    <script src="https://vjs.zencdn.net/8.20.4/video.min.js" defer></script>
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js" defer></script>
    <script src="https://unpkg.com/videojs-contrib-dash@2.11.0/dist/videojs-dash.min.js" defer></script>
    <script src="https://unpkg.com/videojs-hls-quality-selector@1.1.3/dist/videojs-hls-quality-selector.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/gh/fyaz05/Resources@main/FileToLink/script.js" defer></script>
    <script>
    window.addEventListener('DOMContentLoaded', function () {
        document.getElementById('current-year').textContent = new Date().getFullYear();
        const fileSrc = "{{ src }}";
        const fileName = "{{ file_name }}";
        const playerEl = document.getElementById('player');
        const player = videojs(playerEl, {controls: true, autoplay: false, preload: 'metadata', fluid: true});
        function buildSources(src) {
            if (!src) return [];
            const lower = src.split('?')[0].toLowerCase();
            if (lower.endsWith('.m3u8')) return [{ src, type: 'application/x-mpegURL' }];
            if (lower.endsWith('.mpd')) return [{ src, type: 'application/dash+xml' }];
            return [{ src, type: 'video/mp4' }];
        }
        player.src(buildSources(fileSrc));
        if (player.hlsQualitySelector) player.hlsQualitySelector({ displayCurrentQuality: true });
        playerEl.addEventListener('contextmenu', e => e.preventDefault());
        document.getElementById('download-btn').addEventListener('click', function () {
            if (!fileSrc) return;
            const a = document.createElement('a');
            a.href = fileSrc;
            a.download = fileName || '';
            document.body.appendChild(a);
            a.click(); a.remove();
        });
        document.getElementById('copy-btn').addEventListener('click', async function () {
            if (!fileSrc) return;
            try {
                await navigator.clipboard.writeText(fileSrc);
                alert('Link copied to clipboard.');
            } catch (err) {
                alert('Could not copy link.');
            }
        });
    });
    </script>
</body>
</html>
